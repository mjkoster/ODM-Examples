{
  "info": {
    "title": "SDF model for the Modbus message (transmission) layer", 
    "version": "2020-06-15", 
    "copyright": "Copyright Michael J. Koster\n        All rights reserved.", 
    "license": "pointer to common BSD 3-clause"
  }, 
  "namespace": {
    "fb": "https://onedm.org/exploratory/fieldbus/"
  }, 
  "defaultNamespace": "fb", 
  "sdfObject": {
    "modbusMessage": {
      "description": "The Modbus message layer",
      "label": "Modbus Message Layer",

      "sdfProperty": {
        "modbusRequestFrame": {
          "type": "array",
          "items": [
            { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusAddress" },
            { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusFunctionCode" },
            { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusData" },
            { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusCheckData" }
          ]
        },
        "modbusResponseFrame": {
          "type": "array",
          "items": [
            { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusAddress" },
            { 
              "anyOf":[
                { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusFunctionCode" },
                { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusFunctionExceptionCode" }
              ]
            },
            {
              "anyOf": [
                { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusData" },
                { "sdfRef": "#/sdfObject/modbusMessage/sdfEvent/modbusException/sdfData/modbusExceptionCode" }
              ]
            },
            { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusCheckData" }
          ]
        }      
      }, 

      "sdfAction": {
        "sendRequest": {
          "sdfInputData": [
            "#/sdfObject/modbusMessage/sdfAction/sendRequest/sdfData/requestFrame"
          ],
          "sdfData": {
            "requestFrame": {
              "sdfRef": "#/sdfObject/modbusMessage/sdfProperty/modbusRequestFrame"
            }
          }
         }, 
        "sendResponse": { 
          "sdfInputData": [
            "#/sdfObject/modbusMessage/sdfAction/sendRequest/sdfData/responseFrame"
          ],
          "sdfData": {
            "responseFrame": {
              "sdfRef": "#/sdfObject/modbusMessage/sdfProperty/modbusResponseFrame"
            }
          }
    
        }
      },

      "sdfEvent": {
        "modbusException": {
          "sdfData": {
            "modbusExceptionCode": {
              "enum": [ 1,2,3,4,5,6 ],
              "sdfEnum": {
                "illegalFunction": {
                  "const": 1
                },
                "illegalDataAddress": {
                  "const": 2
                },
                "illegalDataValue": {
                  "const": 3
                },
                "responderFailure": {
                  "const": 4
                },
                "acknowledge": {
                  "const": 5
                },
                "responderBusy": {
                  "const": 6
                }
              }
            }
          }
        }
      },

      "sdfData": {
        "modbusTransactionID": {
          "type": "number", 
          "minimum": 0,
          "maximum": 65535
        },
        "modbusProtocolID": {
          "type": "number", 
          "minimum": 0,
          "maximum": 65535
        },
        "length": {
          "type": "number", 
          "minimum": 0,
          "maximum": 65535
        },
        "modbusAddress": {
          "type": "number", 
          "minimum": 0,
          "maximum": 255
        },      
        "modbusData": {
          "type": "string",
          "subType": "byteString",
          "minLength": 0
        },
        "modbusCheckData": {
          "type": "number", 
          "oneOf": [
            {
              "minimum": 0,
              "maximum": 255
            },
            {
              "minimum": 0,
              "maximum": 65535
            }
          ]
        },
        "modbusFunctionCode": {
          "type": "number", 
          "minimum": 0,
          "maximum": 127,
          "sdfEnum": {
            "readCoilStatus": {
              "const": 1
            },
            "readInputStatus": {
              "const": 2
            },         
            "readHoldingRegisters": {
              "const": 3
            },
            "readInputRegisters": {
              "const": 4
            },
            "forceSingleCoil": {
              "const": 5
            },
            "presetSingleRegister": {
              "const": 6
            },
            "readExceptionStatus": {
              "const": 7
            },
            "forceMultipleCoils": {
              "const": 15
            },
            "presetMultipleRegisters": {
              "const": 16
            },
            "reportResponderID": {
              "const": 17
            }         
          }
        },
        "modbusFunctionExceptionCode": {
          "type": "number", 
          "minimum": 128,
          "maximum": 255,
          "sdfEnum": {
            "readCoilStatusException": {
              "const": 129
            },
            "readInputStatusException": {
              "const": 130
            },         
            "readHoldingRegistersException": {
              "const": 131
            },
            "readInputRegistersException": {
              "const": 132
            },
            "forceSingleCoilException": {
              "const": 133
            },
            "presetSingleRegisterException": {
              "const": 134
            },
            "readExceptionStatusException": {
              "const": 135
            },
            "forceMultipleCoilsException": {
              "const": 143
            },
            "presetMultipleRegistersException": {
              "const": 144
            },
            "reportResponderIDException": {
              "const": 145
            }         
          }
        }
      }
    }
  }
}